#!/bin/sh

RUNDIR="/var/run/tcall"
APP="$RUNDIR/pending_approval"
LOG="/var/log/tcall/audit.log"

mkdir -p "$RUNDIR" /var/log/tcall

echo "Tcall Admin Console"

while true; do
    echo
    echo "1) Start session for user"
    echo "2) Stop session for user"
    echo "3) Monitor approvals"
    echo "4) Exit"
    printf "Choice: "
    read CHOICE

    case "$CHOICE" in
        1)
            printf "Username: "
            read USER
            id "$USER" >/dev/null 2>&1 || { echo "Invalid user"; continue; }
            touch "$RUNDIR/session_$USER"
            chown root:tcall "$RUNDIR/session_$USER"
            chmod 660 "$RUNDIR/session_$USER"
            echo "$(date) | ADMIN_START | user=$USER" >> "$LOG"
            echo "Session started for $USER"
            ;;
        2)
            printf "Username: "
            read USER
            rm -f "$RUNDIR/session_$USER"
            echo "$(date) | ADMIN_STOP | user=$USER" >> "$LOG"
            echo "Session stopped for $USER"
            ;;
        3)
            tail -f "$LOG"
            ;;
        4)
            exit 0
            ;;
    esac
done

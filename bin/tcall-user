#!/bin/sh

RUNDIR="/var/run/tcall"
REQ="$RUNDIR/user_request"

echo "Welcome to Tcall (supervised session)"
echo "Type commands normally."
echo "Use: sudo <command> to request admin approval."
echo "Type 'exit' to quit."

while true; do
    printf "tcall> "
    read -r CMD

    [ "$CMD" = "exit" ] && exit 0

    case "$CMD" in
        sudo\ *)
            REAL_CMD="${CMD#sudo }"
            printf "%s|%s\n" "$(whoami)" "$REAL_CMD" > "$REQ"
            echo "Privilege request sent to admin"
            ;;
        *)
            printf "%s|%s\n" "$(whoami)" "$CMD" > "$REQ"
            ;;
    esac
done
